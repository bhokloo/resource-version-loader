{"version":3,"file":"resource-version-loader.min.js","mappings":"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","sources":["webpack://ResourceVersionLoader/webpack/universalModuleDefinition","webpack://ResourceVersionLoader/webpack/startup","webpack://ResourceVersionLoader/./index.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"ResourceVersionLoader\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"ResourceVersionLoader\"] = factory();\n\telse\n\t\troot[\"ResourceVersionLoader\"] = factory();\n})(this, () => {\nreturn ","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = {};\n__webpack_modules__[492](0, __webpack_exports__);\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nfunction fetchLatestVersion(versionEndpoint) {\n    return __awaiter(this, void 0, void 0, function () {\n        var response, data, error_1;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    _a.trys.push([0, 3, , 4]);\n                    return [4 /*yield*/, fetch(versionEndpoint, {\n                            cache: 'no-store',\n                        })];\n                case 1:\n                    response = _a.sent();\n                    return [4 /*yield*/, response.json()];\n                case 2:\n                    data = _a.sent();\n                    return [2 /*return*/, data.version];\n                case 3:\n                    error_1 = _a.sent();\n                    console.error(\"Error fetching latest version:\", error_1);\n                    return [2 /*return*/, null];\n                case 4: return [2 /*return*/];\n            }\n        });\n    });\n}\nfunction appendResourceToHead(type, url) {\n    var element = document.createElement(type);\n    element[type === 'link' ? 'rel' : 'type'] = type === 'link' ? 'stylesheet' : 'module';\n    element[type === 'link' ? 'href' : 'src'] = url;\n    document.head.appendChild(element);\n}\nfunction loadResourceWithCacheBusting(resourceUrl, version) {\n    return \"\".concat(resourceUrl, \"?v=\").concat(version);\n}\nfunction updateResources(version, cssResourceUrl, jsResourceUrl) {\n    var newScriptSrc = loadResourceWithCacheBusting(jsResourceUrl, version);\n    var newCssHref = loadResourceWithCacheBusting(cssResourceUrl, version);\n    appendResourceToHead('link', newCssHref);\n    appendResourceToHead('script', newScriptSrc);\n}\nfunction updateResourcesIfNeeded(versionEndpoint, cssResourceUrl, jsResourceUrl, localVersion, updateLocalVersion) {\n    return __awaiter(this, void 0, void 0, function () {\n        var latestVersion;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, fetchLatestVersion(versionEndpoint)];\n                case 1:\n                    latestVersion = _a.sent();\n                    if (latestVersion && latestVersion !== localVersion) {\n                        updateLocalVersion(latestVersion);\n                        updateResources(latestVersion, cssResourceUrl, jsResourceUrl);\n                    }\n                    return [2 /*return*/];\n            }\n        });\n    });\n}\nfunction resourceVersionLoader(options) {\n    var versionEndpoint = options.versionEndpoint, cssResourceUrl = options.cssResourceUrl, jsResourceUrl = options.jsResourceUrl, localVersion = options.localVersion, updateLocalVersion = options.updateLocalVersion;\n    // Update resources when the page is loaded or refreshed\n    window.onload = function () {\n        updateResourcesIfNeeded(versionEndpoint, cssResourceUrl, jsResourceUrl, localVersion, updateLocalVersion);\n    };\n}\nexports.default = resourceVersionLoader;\n"],"names":["root","factory","exports","module","define","amd","this","__webpack_exports__","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","__generator","body","f","y","t","g","_","label","sent","trys","ops","verb","Symbol","iterator","n","v","op","TypeError","call","pop","length","push","fetchLatestVersion","versionEndpoint","error_1","_a","fetch","cache","json","version","console","error","appendResourceToHead","type","url","element","document","createElement","head","appendChild","loadResourceWithCacheBusting","resourceUrl","concat","updateResourcesIfNeeded","cssResourceUrl","jsResourceUrl","localVersion","updateLocalVersion","latestVersion","newScriptSrc","updateResources","Object","defineProperty","options","window","onload"],"sourceRoot":""}